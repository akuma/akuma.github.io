<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 如何禁用不常用的 HTTP Method · Coding Life</title><meta name="description" content="如何禁用不常用的 HTTP Method - Akuma Huang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://akuma.github.io/atom.xml" title="Coding Life"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/akuma" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">如何禁用不常用的 HTTP Method</h1><div class="post-info">Sep 1, 2011</div><div class="post-content"><h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>出于安全性的考虑，我们想要屏蔽掉客户端以 OPTIONS、TRACE、HEAD、DELETE、PUT 等方式请求 Web 应用，只保留最常用的 GET、POST。</p>
<a id="more"></a>
<h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><h3 id="修改-nginx-配置文件"><a href="#修改-nginx-配置文件" class="headerlink" title="修改 nginx 配置文件"></a>修改 nginx 配置文件</h3><p>nginx 里设置这个比较简单，只需要在 <code>location</code> 节点中添加如下配置即可：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">limit_except</span> GET POST &#123;</div><div class="line">  <span class="attribute">deny</span>   all;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果想要对个别 IP 开放，可以这样设置：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">limit_except</span> GET POST &#123;</div><div class="line">  <span class="attribute">allow</span>  <span class="number">192.168.1.0</span>/<span class="number">32</span>; <span class="comment"># 对客户端 192.168.1.0 - 192.168.1.32 开放</span></div><div class="line">  <span class="attribute">deny</span>   all;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>具体可以参考 nginx 文档：<a href="http://wiki.nginx.org/NginxHttpCoreModule#limit_except" target="_blank" rel="external">http://wiki.nginx.org/NginxHttpCoreModule#limit_except</a></p>
</blockquote>
<p>这种方式适用于应用系统是通过 nginx 做反向代理访问的情况，同时后端的 tomcat 不暴露外网 IP。</p>
<p>经过测试，对于只要允许 GET、POST 请求，HEAD 请求也是支持的，所以这种方式无法在允许 GET、POST 的前提下屏蔽 HEAD。</p>
<h3 id="修改-tomcat（或应用系统）的-web-xml"><a href="#修改-tomcat（或应用系统）的-web-xml" class="headerlink" title="修改 tomcat（或应用系统）的 web.xml"></a>修改 tomcat（或应用系统）的 web.xml</h3><p>如果是 tomcat 直接暴露外网 IP 的情况，那么只能通过修改 <code>web.xml</code> 来实现屏蔽相关 method 的请求。<br>在 <code>web.xml</code> 中添加如下代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">security-constraint</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">web-resource-collection</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">web-resource-name</span>&gt;</span>disabledMethods<span class="tag">&lt;/<span class="name">web-resource-name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">http-method</span>&gt;</span>TRACE<span class="tag">&lt;/<span class="name">http-method</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">http-method</span>&gt;</span>OPTIONS<span class="tag">&lt;/<span class="name">http-method</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">http-method</span>&gt;</span>HEAD<span class="tag">&lt;/<span class="name">http-method</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">http-method</span>&gt;</span>PUT<span class="tag">&lt;/<span class="name">http-method</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">http-method</span>&gt;</span>DELETE<span class="tag">&lt;/<span class="name">http-method</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">web-resource-collection</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">auth-constraint</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">security-constraint</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这样应用系统就只会接受 GET、POST 方式的请求了。</p>
<p>经过测试，如果 <code>&lt;security-constraint&gt;</code> 中没有 <code>&lt;auth-constraint&gt;</code> 子元素的话，配置实际上是不起中用的。<br>如果加入了 <code>&lt;auth-constraint&gt;</code> 子元素，但是其内容为空，这表示所有身份的用户都被禁止访问相应的资源。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2011/10/18/关于-IE6-处理压缩-JavaScript-的-Bug/" class="prev">上一篇</a><a href="/2011/05/26/Memcached-客户端的几种-Hash-算法性能对比/" class="next">下一篇</a></div><div data-thread-key="2011/09/01/如何禁用不常用的-HTTP-Method/" data-title="如何禁用不常用的 HTTP Method" data-url="https://akuma.github.io/2011/09/01/如何禁用不常用的-HTTP-Method/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"iakuma"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2009 - 2017 <a href="https://akuma.github.io">Akuma Huang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>