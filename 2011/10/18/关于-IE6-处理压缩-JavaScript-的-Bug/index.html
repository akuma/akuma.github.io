<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 关于 IE6 处理压缩 JavaScript 的 Bug · Coding Life</title><meta name="description" content="关于 IE6 处理压缩 JavaScript 的 Bug - Akuma Huang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://akuma.github.io/atom.xml" title="Coding Life"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/akuma" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">关于 IE6 处理压缩 JavaScript 的 Bug</h1><div class="post-info">Oct 18, 2011</div><div class="post-content"><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>为了提高客户端 javascript 文件的加载速度，我们将所有的 javascript 代码通过 nginx、tomcat 等进行 gzip 压缩后再发给浏览器。这样原来可能 200 KB 多的脚本文件压缩后之只有 30 KB 多，浏览加载速度提高之后，用户体验就会更好。</p>
<p>但是最近工作中遇到了奇怪的问题，在 IE7、Firefox、Chrome 等浏览器下运行的非常良好的脚本到了 IE6 下有时候就会没有反应，需要刷新网页后才脚本才能运行。</p>
<a id="more"></a>
<p>Google 之后发现微软的官方文档里对 IE6 有提到一点：”Do not enable HTTP compression for the script files”。</p>
<h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>如果应用程序只采用了 <code>tomcat</code> 部署，那么可以通过配置 Connector，只关闭对 IE6 的 javascript 压缩。<br>以下是一个以 <code>Http11NioProtocol Connector</code> 为例的配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"80"</span> <span class="attr">protocol</span>=<span class="string">"org.apache.coyote.http11.Http11NioProtocol"</span></span></div><div class="line">           <span class="attr">maxHttpHeaderSize</span>=<span class="string">"8192"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span></div><div class="line">           <span class="attr">enableLookups</span>=<span class="string">"false"</span> <span class="attr">useBodyEncodingForURI</span>=<span class="string">"true"</span></div><div class="line">           <span class="attr">connectionTimeout</span>=<span class="string">"30000"</span> <span class="attr">disableUploadTimeout</span>=<span class="string">"true"</span></div><div class="line">           <span class="attr">maxThreads</span>=<span class="string">"500"</span> <span class="attr">acceptCount</span>=<span class="string">"1000"</span></div><div class="line">           <span class="attr">compression</span>=<span class="string">"on"</span> <span class="attr">compressionMinSize</span>=<span class="string">"2048"</span></div><div class="line">           <span class="attr">noCompressionUserAgents</span>=<span class="string">"gozilla, traviata, .*MSIE [1-6].*"</span></div><div class="line">           <span class="attr">compressableMimeType</span>=<span class="string">"text/html,text/xml,text/javascript,text/css,text/plain"</span> /&gt;</div></pre></td></tr></table></figure>
<p>如果应用程序采用了 <code>nginx + tomcat</code> 部署，那么可以通过以下配置只关闭对 IE6 的 javascript 压缩。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">gzip_types</span>    text/plain text/css  text/xml application/xml application/xml+rss application/x-javascript text/javascript;</div><div class="line"><span class="attribute">gzip_disable</span>  <span class="string">".*MSIE [1-6].*"</span>;</div></pre></td></tr></table></figure>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>虽然 IE6 在国外已经被埋葬了，但国内仍然有大量的用户在使用它，做为 Web 开发人员的我们仍需要对它有足够的认识。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2011/12/29/Linux-中-Shell-特殊变量的含义解释/" class="prev">上一篇</a><a href="/2011/09/01/如何禁用不常用的-HTTP-Method/" class="next">下一篇</a></div><div data-thread-key="2011/10/18/关于-IE6-处理压缩-JavaScript-的-Bug/" data-title="关于 IE6 处理压缩 JavaScript 的 Bug" data-url="https://akuma.github.io/2011/10/18/关于-IE6-处理压缩-JavaScript-的-Bug/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"iakuma"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2009 - 2017 <a href="https://akuma.github.io">Akuma Huang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>